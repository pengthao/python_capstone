{% extends 'base.html' %} {% block content %}
<div class="jumbotron container-fluid row flex">
  <h1>Favorites</h1>
  <form method="GET" action="{{ url_for('users.my_jobs') }}">
    <label for="sort">Sort by:</label>
    <select name="sort" id="sort">
      <option value="recent">Last Modified</option>
      <option value="status">Status</option>
    </select>
    <button type="submit">Apply</button>
  </form>
  <div class="row">
    {% for result in job_results %}
    {% with _ = form.set_default_status(result.id) %}
    {% endwith %}
    <div class="col-md-2 mb-4">
      <a href="{{ result.url }}"><h3>{{ result.title }}</h3></a>
      <p>Company: {{ result.company }}</p>
      <p>Location: {{ result.location }}</p>
      <p>Salary: {{ result.salary }}</p>
      <p>Description: {{ result.description }}</p>
      <form method="POST">
      {{ form.status.label }} {{ form.status() }}
      <div class="form-check form-switch">
        <input
          class="form-check-input favorite-checkbox"
          type="checkbox"
          role="switch"
          data-result-id="{{ result.id }}"
          checked
        />
      </div>
        {{ form.hidden_tag() }}
        <input type="hidden" name="job_id" value="{{ result.id }}" />
        {{form.submit()}}
        </form>
    </div>

    {% endfor %}
  </div>
</div>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const checkboxes = document.querySelectorAll(".favorite-checkbox");
    checkboxes.forEach((checkbox) => {
      checkbox.addEventListener("change", function () {
        const resultId = this.getAttribute("data-result-id");
        const isChecked = this.checked;

        console.log(resultId);

        fetch("/toggle_favorite", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            result_id: resultId,
          }),
        })
          .then((response) => {
            if (response.ok) {
              console.log("Favorite toggled successfully");
            } else {
              console.error("Failed to toggle favorite");
            }
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      });
    });
  });
</script>
{% endblock %}
